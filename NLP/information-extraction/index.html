<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>基于句法依存树的信息抽取 | 给荔枝打气</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/img/iconL.png"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script><!-- hexo-inject:begin --><!-- hexo-inject:end -->var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '9v8oIeMvyrTiR5LW';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
  </script><!-- hexo-inject:begin --><!-- hexo-inject:end --></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">基于句法依存树的信息抽取</h1><a id="logo" href="/.">给荔枝打气</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">基于句法依存树的信息抽取</h1><div class="post-meta">Dec 16, 2018<span> | </span><span class="category"><a href="/categories/NLP/">NLP</a></span><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><div class="post-content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>信息抽取是一个常见的nlp任务，为经常一起提到的知识图谱的基础。</p>
<!-- hexo-inject:begin --><!-- hexo-inject:end --><p>这里有一份比较好的知识图谱入门资料:<br><a href="https://kgtutorial.github.io/" target="_blank" rel="noopener">Mining Knowledge Graphs from Text</a></p>
<p>信息抽取分为有监督和无监督方法。实际中监督信息往往是缺失的，所以本文主要提无监督方法。</p>
<p>在无监督方法中，一个广泛采用的工具是句法依存树，或者叫句法解析树（Dependency Tree）。</p>
<a id="more"></a>

<p>可视化工具：</p>
<ul>
<li><a href="http://spyysalo.github.io/conllu.js/" target="_blank" rel="noopener">conllu.js</a></li>
<li><a href="http://nlp.nju.edu.cn/tanggc/tools/DependencyViewer.html" target="_blank" rel="noopener">Dependency Viewer</a></li>
</ul>
<p>工作中总结出来的一种基于句法解析树的信息提取的一般方法（尚未完善）：</p>
<ol>
<li>从CONLL格式的句法依存解析结果，生成具备孩子节点和父节点索引的树，并获取根结点root_id；</li>
<li>自上而下递归的进行解析，孩子节点的解析结果上传到父节点进行汇总；<ol>
<li>如果当前节点为叶子节点（无孩子节点），判断当前节点类型，返回dict，上传给父节点；</li>
<li>如果当前词为动词（一般句子的核心是动词，一般方法也都是从动词开始扩展）或者用户指定的目标词，根据制定的规则提取指定关系类型的孩子，如定中关系、状中关系、动宾关系、主谓关系等，这里需要注意的是并列关系，有可能是补充，有可能是同级并列；</li>
<li>如果当前词非动词，先判断其所属信息类型，若能判断，关系向孩子传递，如不能判断，等待孩子节点上传的结果；</li>
<li>合并所有孩子的信息，按原始句子顺序排序</li>
</ol>
</li>
<li>修正后处理</li>
</ol>
<p>以提取文本中，关于道路信息的（时间、原因、地点、时间）四元组为例，输入句子：</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">黄石高速:因交通管制,晋州站、辛集站、藁城东站双向关闭。因沧州服务区附近K81处黄骅方向发生交通事故,沧州服务区附近K81处黄骅方向车辆缓慢通行约4公里</span></span><br></pre></td></tr></table></figure>

<p>句法解析树：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>	黄石	黄石	nh	nr	<span class="keyword">_</span>	<span class="number">3</span>	SBV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">2</span>	高速	高速	d	d	<span class="keyword">_</span>	<span class="number">3</span>	ADV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">3</span>	:	:	v	v	<span class="keyword">_</span>	<span class="number">0</span>	HED	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">4</span>	因	因	p	p	<span class="keyword">_</span>	<span class="number">14</span>	ADV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">5</span>	交通管制	交通管制	v	v	<span class="keyword">_</span>	<span class="number">4</span>	POB	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">6</span>	,	,	wp	w	<span class="keyword">_</span>	<span class="number">4</span>	WP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">7</span>	晋州站	晋州站	ns	ns	<span class="keyword">_</span>	<span class="number">14</span>	SBV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">8</span>	、	、	wp	w	<span class="keyword">_</span>	<span class="number">9</span>	WP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">9</span>	辛集站	辛集站	n	n	<span class="keyword">_</span>	<span class="number">7</span>	COO	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">10</span>	、	、	wp	w	<span class="keyword">_</span>	<span class="number">12</span>	WP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">11</span>	藁城	藁城	ns	ns	<span class="keyword">_</span>	<span class="number">12</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">12</span>	东站	东站	n	n	<span class="keyword">_</span>	<span class="number">7</span>	COO	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">13</span>	双向	双向	d	d	<span class="keyword">_</span>	<span class="number">14</span>	ADV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">14</span>	关闭	关闭	v	v	<span class="keyword">_</span>	<span class="number">3</span>	COO	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">15</span>	。	。	wp	w	<span class="keyword">_</span>	<span class="number">3</span>	WP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">16</span>	因	因	p	p	<span class="keyword">_</span>	<span class="number">24</span>	ADV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">17</span>	沧州	沧州	ns	ns	<span class="keyword">_</span>	<span class="number">18</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">18</span>	服务区	服务区	n	n	<span class="keyword">_</span>	<span class="number">19</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">19</span>	附近	附近	nd	f	<span class="keyword">_</span>	<span class="number">21</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">20</span>	K81	K81	ws	nx	<span class="keyword">_</span>	<span class="number">21</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">21</span>	处	处	n	n	<span class="keyword">_</span>	<span class="number">22</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">22</span>	黄骅	黄骅	ns	ns	<span class="keyword">_</span>	<span class="number">23</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">23</span>	方向	方向	n	n	<span class="keyword">_</span>	<span class="number">16</span>	POB	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">24</span>	发生	发生	v	v	<span class="keyword">_</span>	<span class="number">3</span>	COO	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">25</span>	交通事故	交通事故	n	n	<span class="keyword">_</span>	<span class="number">24</span>	VOB	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">26</span>	,	,	wp	w	<span class="keyword">_</span>	<span class="number">24</span>	WP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">27</span>	沧州	沧州	ns	ns	<span class="keyword">_</span>	<span class="number">28</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">28</span>	服务区	服务区	n	n	<span class="keyword">_</span>	<span class="number">29</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">29</span>	附近	附近	nd	f	<span class="keyword">_</span>	<span class="number">31</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">30</span>	K81	K81	ws	nx	<span class="keyword">_</span>	<span class="number">31</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">31</span>	处	处	n	n	<span class="keyword">_</span>	<span class="number">34</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">32</span>	黄骅	黄骅	ns	ns	<span class="keyword">_</span>	<span class="number">33</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">33</span>	方向	方向	n	n	<span class="keyword">_</span>	<span class="number">34</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">34</span>	车辆	车辆	n	n	<span class="keyword">_</span>	<span class="number">36</span>	SBV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">35</span>	缓慢	缓慢	a	ad	<span class="keyword">_</span>	<span class="number">36</span>	ADV	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">36</span>	通行	通行	v	v	<span class="keyword">_</span>	<span class="number">24</span>	COO	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">37</span>	约	约	d	d	<span class="keyword">_</span>	<span class="number">38</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">38</span>	<span class="number">4</span>	<span class="number">4</span>	m	m	<span class="keyword">_</span>	<span class="number">39</span>	ATT	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">39</span>	公里	公里	q	q	<span class="keyword">_</span>	<span class="number">36</span>	CMP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br><span class="line"><span class="number">40</span>	。	。	wp	w	<span class="keyword">_</span>	<span class="number">3</span>	WP	<span class="keyword">_</span>	<span class="keyword">_</span></span><br></pre></td></tr></table></figure>

<p><img src="https://picbed-1252770021.cos.ap-chengdu.myqcloud.com/NLP/test_dependency.png" alt><br>核心代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordBean</span><span class="params">(object)</span>:</span></span><br><span class="line">   <span class="string">''' 扩展conllword，存储父节点与孩子节点索引 '''</span></span><br><span class="line"></span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">           self.lemma = <span class="literal">None</span></span><br><span class="line">           self.postag = <span class="literal">None</span></span><br><span class="line">           self.relation = <span class="literal">None</span></span><br><span class="line">           self.head_id = <span class="literal">None</span></span><br><span class="line">           self.flag = <span class="literal">True</span>  <span class="comment"># 是否还处于树中标志位，已合并的ATT将置为False</span></span><br><span class="line">           self.child = []</span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">set_word</span><span class="params">(self, conll_word)</span>:</span></span><br><span class="line">           self.lemma = conll_word.LEMMA</span><br><span class="line">           self.postag = conll_word.POSTAG</span><br><span class="line">           self.relation = conll_word.DEPREL</span><br><span class="line">           self.head_id = conll_word.HEAD.ID - <span class="number">1</span></span><br><span class="line">   </span><br><span class="line">       <span class="function"><span class="keyword">def</span> <span class="title">add_child</span><span class="params">(self, child_id, child_relation)</span>:</span></span><br><span class="line">           self.child.append((child_id, child_relation))</span><br><span class="line">       </span><br><span class="line">   </span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">extract_entity_tuple</span><span class="params">(self, dependency_tree, seed_id, head_type=<span class="string">''</span>)</span>:</span></span><br><span class="line">       <span class="string">'''自上而下解析树'''</span></span><br><span class="line">       res_entity_tuple_list = []</span><br><span class="line">       res_dict = dict()</span><br><span class="line">       res_dict[<span class="string">'time'</span>] = []</span><br><span class="line">       res_dict[<span class="string">'reason'</span>] = []</span><br><span class="line">       res_dict[<span class="string">'place'</span>] = []</span><br><span class="line">       res_dict[<span class="string">'status'</span>] = []</span><br><span class="line">       <span class="comment"># 判断是否是叶子节点</span></span><br><span class="line">       <span class="keyword">if</span> len(dependency_tree[seed_id].child) == <span class="number">0</span>:</span><br><span class="line">           <span class="keyword">if</span> dependency_tree[seed_id].lemma <span class="keyword">in</span> self.status_set:</span><br><span class="line">               res_dict[<span class="string">'status'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           <span class="keyword">elif</span> self.check_is_time(dependency_tree, seed_id):</span><br><span class="line">               res_dict[<span class="string">'time'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           <span class="keyword">elif</span> head_type == <span class="string">'reason'</span>:</span><br><span class="line">               res_dict[<span class="string">'reason'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           <span class="keyword">elif</span> head_type == <span class="string">'time'</span>:</span><br><span class="line">               res_dict[<span class="string">'time'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">not</span> dependency_tree[seed_id].lemma <span class="keyword">in</span> self.discard_word_set:</span><br><span class="line">                   res_dict[<span class="string">'place'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           res_entity_tuple_list.append(res_dict)</span><br><span class="line">           <span class="keyword">return</span> res_entity_tuple_list</span><br><span class="line"></span><br><span class="line">       <span class="comment"># 非叶子节点需要向下递归解析</span></span><br><span class="line">       <span class="keyword">if</span> dependency_tree[seed_id].lemma <span class="keyword">in</span> self.status_set:</span><br><span class="line">           <span class="comment"># 当前节点为状态节点</span></span><br><span class="line">           status_merge_list = []</span><br><span class="line">           <span class="keyword">for</span> c_id, c_relation <span class="keyword">in</span> dependency_tree[seed_id].child:</span><br><span class="line">               child_bean = dependency_tree[c_id]</span><br><span class="line">               <span class="keyword">if</span> c_relation <span class="keyword">in</span> (<span class="string">'COO'</span>, <span class="string">'并列关系'</span>):</span><br><span class="line">                   <span class="comment"># 假设状态下不存在嵌套状态，有视为补充</span></span><br><span class="line">                   <span class="keyword">if</span> dependency_tree[c_id].postag == <span class="string">'v'</span> <span class="keyword">and</span> len(dependency_tree[c_id].child) == <span class="number">0</span>:</span><br><span class="line">                       res_dict[<span class="string">'status'</span>].append((c_id, dependency_tree[c_id].lemma))</span><br><span class="line">                   <span class="keyword">else</span>:</span><br><span class="line">                       child_dict_list = self.extract_entity_tuple(dependency_tree, c_id)</span><br><span class="line">                       <span class="keyword">for</span> child_dict <span class="keyword">in</span> child_dict_list:</span><br><span class="line">                           self.merge_two_tuple_dict(res_dict, child_dict)</span><br><span class="line">               <span class="keyword">elif</span> c_relation <span class="keyword">in</span> (<span class="string">'ADV'</span>, <span class="string">'状中结构'</span>):</span><br><span class="line">                   <span class="comment"># 处理状中结构</span></span><br><span class="line">                   <span class="keyword">if</span> child_bean.lemma <span class="keyword">in</span> (<span class="string">'因'</span>, <span class="string">'受'</span>, <span class="string">'由于'</span>):</span><br><span class="line">                       <span class="comment"># 处理原因</span></span><br><span class="line">                       child_dict_list = self.extract_entity_tuple(dependency_tree, c_id)</span><br><span class="line">                       <span class="keyword">for</span> child_dict <span class="keyword">in</span> child_dict_list:</span><br><span class="line">                           self.merge_two_tuple_dict(res_dict, child_dict)</span><br><span class="line">                   <span class="keyword">elif</span> child_bean.lemma == <span class="string">'处'</span> <span class="keyword">or</span> child_bean.postag == <span class="string">'p'</span>:</span><br><span class="line">                       child_dict_list = self.extract_entity_tuple(dependency_tree, c_id)</span><br><span class="line">                       <span class="keyword">for</span> child_dict <span class="keyword">in</span> child_dict_list:</span><br><span class="line">                           self.merge_two_tuple_dict(res_dict, child_dict)</span><br><span class="line">                   <span class="keyword">elif</span> child_bean.postag <span class="keyword">in</span> (<span class="string">'a'</span>, <span class="string">'ad'</span>, <span class="string">'d'</span>):</span><br><span class="line">                       self.merge_att(dependency_tree, c_id)</span><br><span class="line">                       status_merge_list.append(c_id)</span><br><span class="line">                   <span class="keyword">elif</span> self.check_is_time(dependency_tree, c_id):</span><br><span class="line">                       self.merge_att(dependency_tree, c_id)</span><br><span class="line">                       res_dict[<span class="string">'time'</span>].append((c_id, dependency_tree[c_id].lemma))</span><br><span class="line">               <span class="keyword">elif</span> c_relation <span class="keyword">in</span> (<span class="string">'POB'</span>, <span class="string">'介宾关系'</span>) <span class="keyword">and</span> </span><br><span class="line">                       child_bean.lemma <span class="keyword">in</span> (<span class="string">'因'</span>, <span class="string">'受'</span>, <span class="string">'由于'</span>):</span><br><span class="line">                   self.merge_att(dependency_tree, c_id)</span><br><span class="line">                   res_dict[<span class="string">'reason'</span>].append((c_id, dependency_tree[c_id].lemma))</span><br><span class="line">               <span class="keyword">elif</span> c_relation <span class="keyword">in</span> (<span class="string">'CMP'</span>, <span class="string">'动补结构'</span>):</span><br><span class="line">                   self.merge_att(dependency_tree, c_id)</span><br><span class="line">                   status_merge_list.append(c_id)</span><br><span class="line">               <span class="keyword">elif</span> c_relation <span class="keyword">in</span> (<span class="string">'SBV'</span>, <span class="string">'主谓关系'</span>):</span><br><span class="line">                   <span class="comment"># 处理主谓关系，解析具体地点</span></span><br><span class="line">                   child_dict_list = self.extract_entity_tuple(dependency_tree, c_id)</span><br><span class="line">                   <span class="keyword">for</span> child_dict <span class="keyword">in</span> child_dict_list:</span><br><span class="line">                       self.merge_two_tuple_dict(res_dict, child_dict)</span><br><span class="line">               <span class="keyword">elif</span> c_relation <span class="keyword">in</span> (<span class="string">'VOB'</span>, <span class="string">'动宾关系'</span>):</span><br><span class="line">                   <span class="keyword">if</span> len(dependency_tree[c_id].child) == <span class="number">0</span>:</span><br><span class="line">                       res_dict[<span class="string">'status'</span>].append((c_id, dependency_tree[c_id].lemma))</span><br><span class="line">                   <span class="keyword">else</span>:</span><br><span class="line">                       child_dict_list = self.extract_entity_tuple(dependency_tree, c_id)</span><br><span class="line">                       <span class="keyword">for</span> child_dict <span class="keyword">in</span> child_dict_list:</span><br><span class="line">                           self.merge_two_tuple_dict(res_dict, child_dict)</span><br><span class="line"></span><br><span class="line">           status_buffer = []</span><br><span class="line">           status_merge_list.append(seed_id)</span><br><span class="line">           status_merge_list.sort()</span><br><span class="line">           <span class="keyword">for</span> id <span class="keyword">in</span> status_merge_list:</span><br><span class="line">               status_buffer.append(dependency_tree[id].lemma)</span><br><span class="line">           res_dict[<span class="string">'status'</span>].append((seed_id, <span class="string">''</span>.join(status_buffer)))</span><br><span class="line"></span><br><span class="line">           res_entity_tuple_list.append(res_dict)</span><br><span class="line">           <span class="keyword">return</span> res_entity_tuple_list</span><br><span class="line">       <span class="keyword">else</span>:</span><br><span class="line">           <span class="comment"># 当前节点为非状态节点</span></span><br><span class="line">           pre_head_type = head_type</span><br><span class="line">           <span class="keyword">if</span> self.check_is_time(dependency_tree, seed_id):</span><br><span class="line">               <span class="comment"># 为时间节点</span></span><br><span class="line">               head_type = <span class="string">'time'</span></span><br><span class="line">               res_dict[<span class="string">'time'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           <span class="keyword">elif</span> dependency_tree[seed_id].lemma <span class="keyword">in</span> (<span class="string">'因'</span>, <span class="string">'受'</span>, <span class="string">'由于'</span>) <span class="keyword">or</span> head_type == <span class="string">'reason'</span>:</span><br><span class="line">               <span class="comment"># 为原因节点</span></span><br><span class="line">               head_type = <span class="string">'reason'</span></span><br><span class="line">               res_dict[<span class="string">'reason'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               <span class="keyword">if</span> <span class="keyword">not</span> dependency_tree[seed_id].lemma <span class="keyword">in</span> self.discard_word_set:</span><br><span class="line">                   res_dict[<span class="string">'place'</span>].append((seed_id, dependency_tree[seed_id].lemma))</span><br><span class="line">           child_dict_list = []</span><br><span class="line">           coo_list = []</span><br><span class="line">           <span class="keyword">for</span> c_id, c_relation <span class="keyword">in</span> dependency_tree[seed_id].child:</span><br><span class="line">               <span class="comment"># if c_relation in ('COO', '并列关系'):</span></span><br><span class="line">               <span class="comment">#     coo_list.append(c_id)</span></span><br><span class="line">               <span class="keyword">if</span> c_relation <span class="keyword">in</span> (<span class="string">'WP'</span>, <span class="string">'标点符号'</span>):</span><br><span class="line">                   <span class="keyword">continue</span></span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   <span class="keyword">if</span> head_type == <span class="string">'reason'</span> <span class="keyword">and</span> <span class="keyword">not</span> pre_head_type == <span class="string">'reason'</span>:</span><br><span class="line">                       <span class="keyword">if</span> c_relation <span class="keyword">in</span> (<span class="string">'POB'</span>, <span class="string">'介宾关系'</span>):</span><br><span class="line">                           child_dict_list.extend(self.extract_entity_tuple(dependency_tree, c_id, head_type))</span><br><span class="line">                           <span class="keyword">if</span> dependency_tree[c_id].lemma <span class="keyword">in</span> self.status_set:</span><br><span class="line">                               res_dict[<span class="string">'reason'</span>].append((c_id, dependency_tree[c_id].lemma))</span><br><span class="line">                   <span class="keyword">else</span>:</span><br><span class="line">                       child_dict_list.extend(self.extract_entity_tuple(dependency_tree, c_id, head_type))</span><br><span class="line"></span><br><span class="line">           <span class="comment"># 先合并非状态</span></span><br><span class="line">           status_dict_list = []</span><br><span class="line">           <span class="keyword">for</span> child_dict <span class="keyword">in</span> child_dict_list:</span><br><span class="line">               <span class="keyword">if</span> len(child_dict[<span class="string">'status'</span>]) &gt; <span class="number">0</span>:</span><br><span class="line">                   status_dict_list.append(child_dict)</span><br><span class="line">               <span class="keyword">else</span>:</span><br><span class="line">                   self.merge_two_tuple_dict(res_dict, child_dict)</span><br><span class="line"></span><br><span class="line">           <span class="comment"># 再合并存在状态的</span></span><br><span class="line">           <span class="keyword">if</span> len(status_dict_list) == <span class="number">0</span>:</span><br><span class="line">               res_entity_tuple_list.append(res_dict)</span><br><span class="line">           <span class="keyword">else</span>:</span><br><span class="line">               <span class="keyword">for</span> child_dict <span class="keyword">in</span> status_dict_list:</span><br><span class="line">                   <span class="comment"># tmp_dict = res_dict.copy()</span></span><br><span class="line">                   tmp_dict = copy.deepcopy(res_dict)</span><br><span class="line">                   self.merge_two_tuple_dict(tmp_dict, child_dict)</span><br><span class="line">                   res_entity_tuple_list.append(tmp_dict)</span><br><span class="line"></span><br><span class="line">           <span class="keyword">return</span> res_entity_tuple_list</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">def</span> <span class="title">extract_information</span><span class="params">(self, line)</span>:</span></span><br><span class="line">       segs = self.nlp_tokenizer.seg(line)</span><br><span class="line">       <span class="comment"># fix segs</span></span><br><span class="line">       self.fix_seged_postag(segs)</span><br><span class="line">       conll_words = self.parser.parse(segs).getWordArray()</span><br><span class="line">       dependency_tree, root_id = self.construct_dependency_tree(conll_words)</span><br><span class="line"></span><br><span class="line">       res_entity.append(self.extract_entity_tuple(dependency_tree, i))</span><br><span class="line">       res_entity = self.extract_entity_tuple(dependency_tree, root_id)</span><br><span class="line"></span><br><span class="line">       <span class="comment"># print entity tuples</span></span><br><span class="line">       <span class="keyword">for</span> entity <span class="keyword">in</span> res_entity:</span><br><span class="line">           entity[<span class="string">'time'</span>].sort()</span><br><span class="line">           entity[<span class="string">'place'</span>].sort()</span><br><span class="line">           entity[<span class="string">'reason'</span>].sort()</span><br><span class="line">           entity[<span class="string">'status'</span>].sort()</span><br><span class="line">           self.fix_entity_tuple_dict(entity)</span><br><span class="line">           print(entity)</span><br><span class="line">       <span class="keyword">return</span> res_entity</span><br></pre></td></tr></table></figure>

<p>实验结果：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 输入句子</span><br><span class="line"><span class="string">'黄石高速:因交通管制,晋州站、辛集站、藁城东站双向关闭。因沧州服务区附近K81处黄骅方向发生交通事故,沧州服务区附近K81处黄骅方向车辆缓慢通行约4公里。'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 信息提取结果</span><br><span class="line">&#123;<span class="string">'time'</span>: [], <span class="string">'reason'</span>: [<span class="string">'因交通管制'</span>], <span class="string">'place'</span>: [<span class="string">'黄石高速:, 晋州站, 辛集站, 藁城东站'</span>], <span class="string">'status'</span>: [<span class="string">'交通管制, 双向关闭'</span>]&#125;</span><br><span class="line">&#123;<span class="string">'time'</span>: [], <span class="string">'reason'</span>: [<span class="string">'因沧州服务区附近K81处黄骅方向'</span>], <span class="string">'place'</span>: [<span class="string">'黄石高速:, 发生交通事故, 沧州服务区附近K81处黄骅方向'</span>], <span class="string">'status'</span>: [<span class="string">'缓慢通行约4公里'</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，第一句的解析没问题，但是第二句原因的解析边界出错。当前的解析方法仍然比较依赖于句法依存树的准确性，实体的边界的准确性不够，也是需要改进的地方。</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>zeki</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/NLP/information-extraction/">https://zekizz.github.io/NLP/information-extraction/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外均为博主原创，转载请注明出处！</li></ul></div><br><div class="tags"><a href="/tags/NLP/">NLP</a></div><div class="post-nav"><a class="pre" href="/git/git_notes/">git笔记</a><a class="next" href="/ML/imblanced-samples/">样本类别不均衡处理</a></div><div id="lv-container" data-id="city" data-uid="MTAyMC80NzQ1Ni8yMzk1Ng=="><script>(function(d, s) {
   var j, e = d.getElementsByTagName(s)[0];
   if (typeof LivereTower === 'function') { return; }
   j = d.createElement(s);
   j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
   j.async = true;
   e.parentNode.insertBefore(j, e);
})(document, 'script');
</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="https://zekizz.github.io"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Blog/">Blog</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ML/">ML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLU/">NLU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/html/">html</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/others/">others</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/visualisation/">visualisation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/心情/">心情</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/推荐系统/">推荐系统</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/数据结构/" style="font-size: 15px;">数据结构</a> <a href="/tags/NLP/" style="font-size: 15px;">NLP</a> <a href="/tags/machine-learning/" style="font-size: 15px;">machine learning</a> <a href="/tags/深度学习/" style="font-size: 15px;">深度学习</a> <a href="/tags/NER/" style="font-size: 15px;">NER</a> <a href="/tags/excel/" style="font-size: 15px;">excel</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/graph-embedding/" style="font-size: 15px;">graph embedding</a> <a href="/tags/半监督分类/" style="font-size: 15px;">半监督分类</a> <a href="/tags/CRF/" style="font-size: 15px;">CRF</a> <a href="/tags/RNN/" style="font-size: 15px;">RNN</a> <a href="/tags/概率图模型/" style="font-size: 15px;">概率图模型</a> <a href="/tags/html/" style="font-size: 15px;">html</a> <a href="/tags/前端/" style="font-size: 15px;">前端</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/语音处理/" style="font-size: 15px;">语音处理</a> <a href="/tags/推荐系统/" style="font-size: 15px;">推荐系统</a> <a href="/tags/multi-label/" style="font-size: 15px;">multi-label</a> <a href="/tags/sklearn/" style="font-size: 15px;">sklearn</a> <a href="/tags/NLU/" style="font-size: 15px;">NLU</a> <a href="/tags/甜/" style="font-size: 15px;">甜</a> <a href="/tags/文本处理/" style="font-size: 15px;">文本处理</a> <a href="/tags/可视化/" style="font-size: 15px;">可视化</a> <a href="/tags/文件/" style="font-size: 15px;">文件</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/ML/sklearn-multi-label/">考虑未定义类型的多分类</a></li><li class="post-list-item"><a class="post-list-link" href="/visualisation/vue文件上传下载/">vue文件上传下载</a></li><li class="post-list-item"><a class="post-list-link" href="/NLU/nlu-survey/">NLU调研</a></li><li class="post-list-item"><a class="post-list-link" href="/python/configparse/">configparser配置解析</a></li><li class="post-list-item"><a class="post-list-link" href="/others/excel_trick/">excel去除文本中的不可打印字符</a></li><li class="post-list-item"><a class="post-list-link" href="/git/git_notes/">git笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/NLP/information-extraction/">基于句法依存树的信息抽取</a></li><li class="post-list-item"><a class="post-list-link" href="/ML/imblanced-samples/">样本类别不均衡处理</a></li><li class="post-list-item"><a class="post-list-link" href="/html/html-tag/">html自定义标签</a></li><li class="post-list-item"><a class="post-list-link" href="/html/web-space/">网页文本中空格</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://blog.csdn.net/crystal_zero" title="zeki的csdn" target="_blank">zeki的csdn</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
<span id="busuanzi_container_site_uv">总访客<span id="busuanzi_value_site_uv"></span>人</span>
<br>Copyright © 2019 <a href="/." rel="nofollow">给荔枝打气.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><!-- MathJax配置，可通过单美元符号书写行内公式等 --><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
  inlineMath: [['$','$'], ['\\(','\\)']],
  processEscapes: true,
  ignoreClass: "tex2jax_ignore|dno",
  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  TeX: {
  equationNumbers: { autoNumber: "AMS" },
  noUndefined: {attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" }},
  Macros: {href: "{}"}
  },
  messageStyle: "none",
  "HTML-CSS": {
  preferredFont: "TeX",
  availableFonts: ["STIX","TeX"],
  linebreaks: { automatic:true },
  EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) 
  }
  });
</script><!-- 给MathJax元素添加has-jax class --><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
 var all = MathJax.Hub.getAllJax(), i;
 for(i=0; i < all.length; i += 1) {
   all[i].SourceElement().parentNode.className += ' has-jax';
   }
 });
</script><!-- script(type='text/javascript', src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML') --><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/shizuku.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":150,"vOffset":-20},"mobile":{"show":true},"react":{"opacity":0.9}});</script><!-- hexo-inject:begin --><!-- hexo-inject:end --></body></html>